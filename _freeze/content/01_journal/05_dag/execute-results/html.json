{
  "hash": "235ec998ac1308815279b7fb7ebf7683",
  "result": {
    "markdown": "---\ntitle: \"Directed Acyclic Graphs\"\nauthor: \"Lucas Rousselange\"\nexecute:\n  warning: false\nformat:\n  html:\n    code-fold: true\nnumber-sections: false\n---\n\n\n# Task 1\nThe DAG for the store parking spot example only contains two nodes:\n\n* $D$: Parking spots (Treatment variable)\n* $Y$: Sales (Outcome variable)\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-1_e9c712749244e07bc84c9c143c59e744'}\n\n```{.r .cell-code}\nlibrary(dagitty)\nlibrary(ggdag)\nlibrary(ggplot2)\ndag_model <- 'dag {\nD [exposure,pos=\"0.075,0.4\"]\nY [outcome,pos=\"0.4,0.4\"]\nD -> Y\n}'\n# draw DAG\np <- ggdag_status(dag_model) +\n  guides(fill = \"none\", color = \"none\") +  # Disable the legend\n  geom_dag_edges(edge_color = \"black\")+\n  theme_dag_blank()\np\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n# Task 2\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-2_4377488242b6ff1b81a262f66d47598a'}\n\n```{.r .cell-code}\nlibrary(jtools)\ncustomer_sat <- readRDS(\"../../../Causal_Data_Science_Data/customer_sat.rds\")\nlm_sat <- lm(satisfaction ~ follow_ups, data=customer_sat)\nlm_sat_mod <- lm(satisfaction ~ ., data=customer_sat)\nf_R <- sprintf(\"%0.2f\",coef(lm_sat)[2])\nf_R_mod <- sprintf(\"%0.2f\",coef(lm_sat_mod)[2])\nexport_summs(lm_sat, lm_sat_mod)\n```\n\n::: {.cell-output-display}\n```{=html}\n<table class=\"huxtable\" data-quarto-disable-processing=\"true\" style=\"border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  \" id=\"tab:unnamed-chunk-2\">\n<col><col><col><tr>\n<th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">Model 1</th><th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">Model 2</th></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(Intercept)</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">78.89 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">26.77 **&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(4.27)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(6.68)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">follow_ups</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">-3.31 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">2.19 *&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(0.66)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(0.78)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">subscriptionPremium</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">44.72 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(5.62)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">subscriptionPremium+</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">18.07 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(2.17)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">N</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">R2</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.66&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.96&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th colspan=\"3\" style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</th></tr>\n</table>\n\n```\n:::\n:::\n\n\n# Task 3 \n## Comparison\nComparing both models, we can see that our model which accounts for subscriptions has a much better accuracy than the one that does not.A coefficient reversal takes place when changing models. For our follow-up only model, the follow-up correlation coefficient is $R =-3.31$, while it changes to $R =2.19$ when subscrition model is taken into account.\n\n### Follow-up only \n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-3_0e2d72bf435976fb3f0137e16d09d3f8'}\n\n```{.r .cell-code}\neffect_plot(lm_sat, follow_ups, interval = TRUE, plot.points = TRUE)\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Follow-up & Subscrition\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-4_9d24392e0cdbe7b3abf5031f70095696'}\n\n```{.r .cell-code}\neffect_plot(lm_sat_mod, follow_ups, interval = TRUE, plot.points = TRUE)\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n## Explanation \nA possible explanation is that the subscription is a confounding factor. Another possible explanation is that the subscription is a collision factor. The most probable explanation is that the subscription is a confounding factor, as the follow-up calls rise and the satisfaction falls with increasing subscription level. Users who use the software the most and the most features (Elite) encounter more problems and need more follow-up calls. This in turn reduces their satisfaction. \n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-5_6cf2cbdd34d263b6aebdb4bb7480b12e'}\n\n```{.r .cell-code}\n# Confounder\nconfounding <- dagify(\n  X ~ Z,\n  Y ~ Z,\n  Y ~ X,\n  coords = list(x = c(Y = 3, Z = 2, X = 1),\n                y = c(Y = 0, Z = 1, X = 0)),\n  labels = list(X = \"follow-ups\",\n                Y = \"satisfaction\",\n                Z = \"subscription\")\n  )\n\n# Plot DAG\nlibrary(dagitty)\nlibrary(ggdag)\nlibrary(ggplot2)\np <- ggdag(confounding) +\n  geom_dag_point(color = \"#15c1d4\") +\n  geom_dag_text(color = \"white\") +\n  geom_dag_edges(edge_color = \"black\") +\n  geom_dag_label_repel(aes(label = label))+\n  theme_dag_blank()\np\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Effect of subscription category on satisfaction\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-6_eef6befaf5519999cb23c1e1f241ab42'}\n\n```{.r .cell-code}\neffect_plot(lm_sat_mod, subscription, interval = TRUE, plot.points = TRUE , \n            jitter = 0.1)\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n### Effect of subscription category on follow-up\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-7_701870b854a1bc278ca6b2d9f115833b'}\n\n```{.r .cell-code}\nlm_sub<-lm(follow_ups ~ subscription, data=customer_sat)\neffect_plot(lm_sub, subscription, interval = TRUE, plot.points = TRUE , \n            jitter = 0.1)\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n# Task 4 \nHere we can clearly see that the satisfaction actually increases for each group with more follow-ups.\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-8_b7bebd584825e4f967ccdbdca8522748'}\n\n```{.r .cell-code}\nlibrary(gridExtra)\n# Not conditioning on education\nsimps_not_cond <- ggplot(customer_sat, aes(x = follow_ups, y = satisfaction)) +\n  geom_point(alpha = .8) +\n  stat_smooth(method = \"lm\", se = F)+\n  theme_apa()\n\n# Conditioning on education  \nsimps_cond <- ggplot(customer_sat, aes(x = follow_ups, y = satisfaction, color = subscription)) +\n  geom_point(alpha = .8) +\n  stat_smooth(method = \"lm\", se = F) +\n  theme_apa()+\n  theme(legend.position = \"bottom\")\n\n# Plot both plots\n#grid.arrange(simps_not_cond, simps_cond, nrow=1)\n```\n:::\n\n\n## Not conditioned \n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-9_29accba89139cadadfc24eee69c5eb9e'}\n\n```{.r .cell-code}\nsimps_not_cond\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Conditioned \n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-10_bb8b42a943e29a36108ccd357d9bc2fa'}\n\n```{.r .cell-code}\nsimps_cond\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}