{
  "hash": "b8ab8a6e89d32dae00cdc4cf4893bb40",
  "result": {
    "markdown": "---\ntitle: \"Randomized Controlled Trials\"\nauthor: \"Lucas Rousselange\"\nexecute:\n  warning: false\nformat:\n  html:\n    code-fold: true\nnumber-sections: false\n---\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-1_aec9b0c824d24ad84684737c66f6bdd1'}\n\n```{.r .cell-code}\n#Load data set and libraries\nlibrary(ggplot2)\nlibrary(jtools)\nlibrary(kableExtra)\nabtest_online <- readRDS(\"../../../Causal_Data_Science_Data/abtest_online.rds\")\n```\n:::\n\n\n\n# Task 1\nThe covariates for which we need to check the balance are: \n\n* Previous site visits \n* Mobile device usage\n\n## Previous site visits\nAs shown below, we can see that both groups look pretty similar, i.e. balanced with respect to previous site visits.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-2_cd34cfe47bcb1e6caec73394119d61f4'}\n\n```{.r .cell-code}\ncompare_visits <- \n  ggplot(abtest_online, \n         aes(x = chatbot, \n             y = previous_visit, \n             color = as.factor(chatbot))) +\n  geom_boxplot(width=0.3, fill=\"white\")+\n  stat_boxplot(geom = 'errorbar', width = 0.4)+\n  labs(x = \"Chatbot acitve\", y = \"Previous visits\", title = 'Previous site visit balance')+\n  theme_minimal()+\n  theme(legend.position = \"none\")\ncompare_visits\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Mobile device usage\nAs the mobile device usage variable is a boolean, we can only compare the ratio of mobile device across both groups. Again, both groups seem balanced.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-3_2d756baf30ba3a81612b8c7bff79e47a'}\n\n```{.r .cell-code}\n#Calculate mobile device usage for each group\nmbu_aggregate=aggregate(abtest_online$mobile_device,by=list(abtest_online$chatbot),FUN=mean)\nnames(mbu_aggregate)<-c('chatbot', 'mobile_device')\n\ncompare_device <- \n  ggplot(mbu_aggregate, \n         aes(x = chatbot, \n             y = mobile_device, \n             color = as.factor(chatbot))) +\n  geom_boxplot(width=0.3, fill=\"white\")+\n  labs(x = \"Chatbot acitve\", y = \"Previous visits\", title = 'Mobile device usage balance')+\n  ylim(0,1)+\n  theme_minimal()+\n  theme(legend.position = \"none\")\ncompare_device\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n# Task 2\nThe result of the regression is shown below:\n\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-4_6c4e1521f77a749966f29598dbbf7e6a'}\n\n```{.r .cell-code}\nreg <- lm(purchase_amount ~ chatbot, abtest_online)\nsumm(reg)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Observations </td>\n   <td style=\"text-align:right;\"> 1000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Dependent variable </td>\n   <td style=\"text-align:right;\"> purchase_amount </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Type </td>\n   <td style=\"text-align:right;\"> OLS linear regression </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> F(1,998) </td>\n   <td style=\"text-align:right;\"> 35.98 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> R² </td>\n   <td style=\"text-align:right;\"> 0.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Adj. R² </td>\n   <td style=\"text-align:right;\"> 0.03 </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Est. </th>\n   <th style=\"text-align:right;\"> S.E. </th>\n   <th style=\"text-align:right;\"> t val. </th>\n   <th style=\"text-align:right;\"> p </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 16.70 </td>\n   <td style=\"text-align:right;\"> 0.84 </td>\n   <td style=\"text-align:right;\"> 19.94 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> chatbotTRUE </td>\n   <td style=\"text-align:right;\"> -7.08 </td>\n   <td style=\"text-align:right;\"> 1.18 </td>\n   <td style=\"text-align:right;\"> -6.00 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Standard errors: OLS</td></tr></tfoot>\n</table>\n`````\n:::\n:::\n\n\nAs we can see, the chatbot has a significative negative result on the average purchase amount, albeit the fit being pretty poor.\n\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-5_ab2cd806eb0927dea501d62901896653'}\n\n```{.r .cell-code}\neffect_plot(reg, chatbot)+\n  labs(x = \"Chatbot acitve\", y = \"Purchase amount\", title = 'Average customer purchase amount')+\n  expand_limits(y=0)\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n# Task 3 \nIf we account for previous visits and mobile device usage, we can see that the results of our AB test changed significantly. \n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-6_b5ad0a36916d07bd9c52e978eae3ef3f'}\n\n```{.r .cell-code}\nreg_cate <- lm(purchase_amount ~ chatbot*mobile_device + chatbot*previous_visit, abtest_online)\nsumm(reg_cate)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Observations </td>\n   <td style=\"text-align:right;\"> 1000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Dependent variable </td>\n   <td style=\"text-align:right;\"> purchase_amount </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Type </td>\n   <td style=\"text-align:right;\"> OLS linear regression </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> F(5,994) </td>\n   <td style=\"text-align:right;\"> 11.56 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> R² </td>\n   <td style=\"text-align:right;\"> 0.05 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Adj. R² </td>\n   <td style=\"text-align:right;\"> 0.05 </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Est. </th>\n   <th style=\"text-align:right;\"> S.E. </th>\n   <th style=\"text-align:right;\"> t val. </th>\n   <th style=\"text-align:right;\"> p </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 17.21 </td>\n   <td style=\"text-align:right;\"> 1.30 </td>\n   <td style=\"text-align:right;\"> 13.25 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> chatbotTRUE </td>\n   <td style=\"text-align:right;\"> -11.11 </td>\n   <td style=\"text-align:right;\"> 1.84 </td>\n   <td style=\"text-align:right;\"> -6.02 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> mobile_deviceTRUE </td>\n   <td style=\"text-align:right;\"> -0.88 </td>\n   <td style=\"text-align:right;\"> 1.78 </td>\n   <td style=\"text-align:right;\"> -0.49 </td>\n   <td style=\"text-align:right;\"> 0.62 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> previous_visit </td>\n   <td style=\"text-align:right;\"> -0.10 </td>\n   <td style=\"text-align:right;\"> 0.37 </td>\n   <td style=\"text-align:right;\"> -0.27 </td>\n   <td style=\"text-align:right;\"> 0.78 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> chatbotTRUE:mobile_deviceTRUE </td>\n   <td style=\"text-align:right;\"> 0.20 </td>\n   <td style=\"text-align:right;\"> 2.51 </td>\n   <td style=\"text-align:right;\"> 0.08 </td>\n   <td style=\"text-align:right;\"> 0.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> chatbotTRUE:previous_visit </td>\n   <td style=\"text-align:right;\"> 2.10 </td>\n   <td style=\"text-align:right;\"> 0.58 </td>\n   <td style=\"text-align:right;\"> 3.63 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Standard errors: OLS</td></tr></tfoot>\n</table>\n`````\n:::\n:::\n\n# Task 4\nRunning a binomial regression for the effect of the chatbot on the purchase behavior of the customer, shows it has a significative negative impact on the average purchase rate.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-7_cec63894ab4013ff438a6984c0d08116'}\n\n```{.r .cell-code}\nreg_log <- glm(purchase ~ chatbot, family=binomial(link='logit'), abtest_online)\nsumm(reg_log)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Observations </td>\n   <td style=\"text-align:right;\"> 1000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Dependent variable </td>\n   <td style=\"text-align:right;\"> purchase </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Type </td>\n   <td style=\"text-align:right;\"> Generalized linear model </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Family </td>\n   <td style=\"text-align:right;\"> binomial </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Link </td>\n   <td style=\"text-align:right;\"> logit </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> χ²(1) </td>\n   <td style=\"text-align:right;\"> 55.77 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (Cragg-Uhler) </td>\n   <td style=\"text-align:right;\"> 0.07 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (McFadden) </td>\n   <td style=\"text-align:right;\"> 0.04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> AIC </td>\n   <td style=\"text-align:right;\"> 1277.33 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> BIC </td>\n   <td style=\"text-align:right;\"> 1287.15 </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Est. </th>\n   <th style=\"text-align:right;\"> S.E. </th>\n   <th style=\"text-align:right;\"> z val. </th>\n   <th style=\"text-align:right;\"> p </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -0.02 </td>\n   <td style=\"text-align:right;\"> 0.09 </td>\n   <td style=\"text-align:right;\"> -0.18 </td>\n   <td style=\"text-align:right;\"> 0.86 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> chatbotTRUE </td>\n   <td style=\"text-align:right;\"> -0.99 </td>\n   <td style=\"text-align:right;\"> 0.13 </td>\n   <td style=\"text-align:right;\"> -7.34 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Standard errors: MLE</td></tr></tfoot>\n</table>\n`````\n:::\n\n```{.r .cell-code}\neffect_plot(reg_log, chatbot)+\n  labs(x = \"Chatbot acitve\", y = \"Purchase rate\", title = 'Average customer purchase rate')+\n  ylim(0,1)\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}